===========================================
VICTORIAN POEMS WEB APPLICATION - PROJECT STATUS
===========================================

PROJECT OVERVIEW
-----------------
Full-stack Victorian-themed poetry web app with AI-powered poem generation.
Users can generate poems (no login required), save them, manage collections, and browse a public gallery.

TECH STACK
----------
Frontend:
- SvelteKit 2 with Svelte 4
- Tailwind CSS (custom Victorian theme: sepia, gold, parchment colors)
- Firebase Firestore (database) + Firebase Auth (authentication)
- Lucide Svelte for icons (NO EMOJIS - all replaced with proper icons)
- Fonts: Playfair Display, Cormorant Garamond, Crimson Text, Old Standard TT

Backend:
- Laravel 12 (PHP)
- Groq AI API (llama-3.3-70b-versatile model) for poem generation
- CORS enabled for SvelteKit frontend

HOW TO RUN
----------
Frontend:
  cd frontend
  npm install
  npm run dev
  → Runs on http://localhost:5173

Backend:
  cd backend
  php artisan serve
  → Runs on http://127.0.0.1:8000

Environment:
  - frontend/.env.local → Firebase config
  - backend/.env → GROQ_API_KEY

COMPLETED FEATURES ✅
--------------------

1. HOME PAGE (/)
   - Victorian landing page with welcome message

2. AUTHENTICATION (/auth/login, /auth/register)
   - Firebase Auth: email/password + Google sign-in
   - Auth state managed via Svelte store

3. AI POEM GENERATOR (/create)
   - NO login required to generate poems
   - AI generates BOTH title AND poem content
   - Title parsing handles multiple AI formats (with/without "TITLE:" prefix)
   - localStorage persistence: saves poem if user needs to login
   - Auto-saves poem after login and redirects to view page
   - Icons: Sparkles, Feather, Copy, Save, Loader2 (spinning)

4. MY POEMS PAGE (/poems)
   - Stats at TOP (Total Poems, Public, AI Generated) - NO "Statistics" header
   - Grid layout with Victorian-styled poem cards
   - Actions: View, Edit, Make Public/Private, Delete
   - All feedback via Modal component (NO JavaScript alerts)
   - Scroll-to-top and scroll-to-bottom buttons (appear when scrolling)
   - Icons: Eye, Edit, Globe, Lock, Trash2, Sparkles, ArrowUp, ArrowDown, BookMarked

5. GALLERY PAGE (/gallery)
   - Browse all public poems (no login required)
   - Search bar ALWAYS visible with search icon
   - Collapsible filters (click "Filters" button to show/hide):
     * Category filter
     * Sentiment filter
     * Shows active filter count badge on button
   - Results count display
   - Scroll buttons (up/down) when user scrolls
   - Icons: Search, SlidersHorizontal, Tag, Heart, Eye, User, Calendar, Scroll, Sparkles

6. HEADER NAVIGATION
   - Logo: Feather icon + "Victorian Poems"
   - Nav links with icons:
     * Create (Sparkles icon)
     * My Poems (BookMarked icon) - only shown if logged in
     * Gallery (Image icon)
   - Auth buttons: Sign In / Register / Sign Out

7. UI/UX IMPROVEMENTS
   - ALL emojis replaced with Lucide icons throughout entire app
   - Modal.svelte component for all user feedback (replaces alert() and confirm())
   - LoadingOverlay.svelte component for full-page loading states with animated Feather icon
   - Victorian styling: parchment backgrounds, sepia/gold accents, ornate fonts
   - Responsive design (mobile + desktop)
   - Hover effects on cards (.hover-lift class)
   - Fade-in animations for collapsible elements

8. EDIT POEM PAGE (/poems/[id]/edit)
   - Full editing interface for poem title, content, and visibility
   - Advanced formatting controls:
     * Font family selector (6 Victorian/classic fonts)
     * Font size slider (12-24px)
     * Text color palette (5 Victorian colors)
     * Text alignment (left, center, right)
     * Line spacing slider (1.0-2.5)
   - Real-time preview of formatted poem
   - Permission check: only author can access edit page
   - Auto-saves and redirects to view page on success
   - Icons: Save, X (cancel), Eye (preview), Lock/Globe, Feather, Type, Palette

FIRESTORE DATA STRUCTURE
------------------------
Collection: poems
{
  authorId: string,
  authorUsername: string,
  title: string,
  content: string (the poem text),
  isAIGenerated: boolean,
  aiPrompt: string (original user prompt if AI generated),
  isPublic: boolean,
  shareId: string (UUID for sharing),
  categories: array (AI-generated tags),
  tags: array,
  sentiment: string (AI-generated),
  views: number,
  formatting: {
    fontFamily: string,
    fontSize: number,
    color: string,
    alignment: string,
    lineSpacing: number
  },
  createdAt: timestamp,
  updatedAt: timestamp
}

IMPORTANT FIXES APPLIED
-----------------------

1. TITLE PARSING BUG (backend/app/Services/GroqService.php)
   Issue: AI was outputting titles without "TITLE:" prefix
   Fix: Added regex to handle both formats:
        - Format 1: "TITLE: Morning's Warm Embrace\n---\n[poem]"
        - Format 2: "Morning's Warm Embrace\n---\n[poem]" (validates <100 chars, single line)

2. FIRESTORE COMPOSITE INDEX ERROR (frontend/src/routes/poems/+page.svelte)
   Issue: Using where() + orderBy() requires composite index
   Fix: Removed orderBy() from Firestore query, sort client-side in JavaScript instead

3. POEM LOST ON LOGIN REDIRECT (frontend/src/routes/create/+page.svelte)
   Issue: Generating poem without login, then clicking save → redirect → poem lost
   Fix: Save poem/title/prompt to localStorage before redirect
        onMount checks for saved data after login, auto-restores and saves poem

4. SAVE FLOW UX (frontend/src/routes/create/+page.svelte)
   Issue: After AI generated title, still asking user to enter title in form
   Fix: Auto-save with AI-generated title, redirect to poem view page immediately
        User can edit title later from view/edit page

5. JAVASCRIPT ALERTS → MODALS
   Issue: Using vanilla alert() and confirm() throughout app
   Fix: Created Modal.svelte component (Victorian-styled)
        Supports types: info, success, error, confirm
        Replaced all alerts in: create page, my poems page, poem view page

FILE STRUCTURE
--------------
poems_viewer/
├── todo.txt (THIS FILE)
├── frontend/
│   ├── src/
│   │   ├── routes/
│   │   │   ├── +page.svelte              (Home/landing)
│   │   │   ├── +layout.svelte            (Root layout with Header)
│   │   │   ├── create/+page.svelte       (AI poem generator) ✅
│   │   │   ├── gallery/+page.svelte      (Public gallery) ✅
│   │   │   ├── poems/
│   │   │   │   ├── +page.svelte          (My Poems list + search) ✅
│   │   │   │   ├── [id]/+page.svelte     (View single poem) ✅
│   │   │   │   └── [id]/edit/+page.svelte (Edit poem) ✅
│   │   │   ├── share/
│   │   │   │   └── [shareId]/+page.svelte (Share poem via URL) ✅
│   │   │   ├── profile/
│   │   │   │   └── [uid]/+page.svelte     (User profile) ✅
│   │   │   └── auth/
│   │   │       ├── login/+page.svelte
│   │   │       └── register/+page.svelte
│   │   ├── lib/
│   │   │   ├── components/
│   │   │   │   ├── Header.svelte         (Nav with Lucide icons) ✅
│   │   │   │   ├── Modal.svelte          (Victorian modal) ✅
│   │   │   │   └── LoadingOverlay.svelte (Full-page loading) ✅
│   │   │   ├── services/
│   │   │   │   ├── firebase.js           (Firebase config)
│   │   │   │   └── api.js                (Backend API calls)
│   │   │   └── stores/
│   │   │       └── auth.js               (Auth state)
│   │   ├── app.css                       (Tailwind + Victorian styles)
│   │   └── app.html
│   ├── tailwind.config.js                (Custom Victorian colors)
│   ├── package.json
│   └── .env.local                        (Firebase keys)
│
└── backend/
    ├── app/
    │   ├── Http/Controllers/API/
    │   │   └── AIController.php          (Poem generation endpoint)
    │   └── Services/
    │       └── GroqService.php           (Groq AI integration) ✅
    ├── routes/
    │   └── api.php                       (API routes)
    ├── bootstrap/app.php                 (CORS config)
    └── .env                              (GROQ_API_KEY)

GIT STATUS
----------
Branch: main
Status: 2 commits ahead of origin/main

Recent commits:
- Add edit poem functionality
- Add LoadingOverlay component and improve user experience
- Remove Statistics title from My Poems stats section
- Change icons
- Replace remaining alert with modal in poem view page

DESIGN PATTERNS USED
--------------------
1. Icons: Lucide Svelte library (NOT emojis)
   - Import from 'lucide-svelte'
   - Use as components: <Sparkles size={18} />

2. Modals: Modal.svelte component (NOT alert/confirm)
   - Types: info, success, error, confirm
   - Binding: bind:show={showModal}

3. Victorian Styling:
   - Colors: gold-600, sepia-700, parchment-50, ink-800
   - Fonts: font-playfair, font-cormorant, font-crimson
   - Components: .card-victorian, .btn-victorian, .input-victorian, .hover-lift

4. Firestore Queries:
   - Avoid orderBy() with where() (requires composite index)
   - Sort client-side with JavaScript .sort() instead

5. Scroll Buttons Pattern:
   - Listen to window scroll event
   - Show/hide buttons when scrollY > 300px
   - scrollTo({ behavior: 'smooth' })

KNOWN CONSTRAINTS
-----------------
- Firebase Firestore composite indexes not used (sorting done client-side)
- AI title parsing assumes title is <100 characters and single-line
- localStorage used for cross-page data (poem persistence during login flow)

9. SHARE POEM PAGE (/share/[shareId])
   - Public share page accessible via unique UUID link
   - Displays poem with full formatting (font, color, alignment, spacing)
   - Shows author, date, AI generated badge, categories/tags
   - Actions: Copy Poem, Copy Share Link, Browse Gallery
   - No login required to view shared poems
   - Share button on poem view page copies share URL to clipboard

10. SEARCH WITHIN MY POEMS (/poems)
    - Search bar with Search icon always visible above poems grid
    - Filters by title, content, categories, and tags
    - Shows result count when searching
    - Empty state with "No poems found" message
    - Client-side filtering (reactive via Svelte $:)

11. USER PROFILE PAGES (/profile/[uid])
    - Shows author name with avatar placeholder (User icon in gold circle)
    - Stats: public poems count, AI generated count
    - Grid of all public poems by that author
    - Clickable author names in gallery, share page, and poem view page
    - Scroll up/down buttons

12. ADVANCED GALLERY SORTING
    - Sort options in filter panel: Newest First, Oldest First
    - Sort applied reactively alongside category/sentiment/search filters
    - 3-column filter layout (Category, Sentiment, Sort By)

13. FAVORITES/BOOKMARKING SYSTEM (/favorites)
    - Heart/bookmark icon on gallery poem cards
    - Toggle bookmark state (add/remove from favorites)
    - New Firestore collection: `favorites` with denormalized poem data
    - Dedicated /favorites page showing bookmarked poems grid
    - Search bar filtering by title, content, author
    - Category and sentiment filters
    - Stats display (Total Bookmarks, AI Generated, Categories)
    - Remove bookmark functionality with Modal confirmation
    - Scroll up/down buttons
    - Header navigation link (Heart icon) when logged in
    - Icons: Heart, Search, Tag, User, Calendar, Eye, Trash2, Sparkles

14. AI CUSTOMIZATION FOR POEM GENERATION (/create)
    - Collapsible "Advanced Options" section with ChevronDown/Up icons
    - Style selector: sonnet, haiku, free_verse, limerick, ballad, romantic, dark, nature
    - Length selector: short (4-8 lines), medium (12-20 lines), long (24+ lines)
    - Rhyme scheme selector: AABB, ABAB, ABCB, free
    - Tone selector: joyful, melancholic, dramatic, peaceful, playful
    - All options optional with "Default (AI chooses)" fallback
    - Backend: Dynamic system prompt builder in GroqService
    - Backend: Adaptive max_tokens (512/1024/1536) based on length
    - Backend: Parameter validation with nullable enum rules
    - API timeout increased to 45s for longer poems
    - Victorian-styled select dropdowns in 2-column grid
    - Backward compatible (all parameters nullable)
    - ⚠️ NOTE: Requires manual testing to verify poem quality across different option combinations

POTENTIAL NEXT FEATURES (NOT STARTED)
-------------------------------------

### HIGH PRIORITY (High Value + Medium/Low Complexity)

1. **Reading Time Estimate**
   - Calculate reading time based on word count (avg 200 words/min)
   - Display on poem cards: "~2 min read"
   - Use Clock icon from Lucide
   - **Why**: Helps users decide what to read
   - **Complexity**: Low (pure calculation, no DB changes)

### MEDIUM PRIORITY (Medium Value + Medium Complexity)

2. **Export Poems as PDF/Images**
   - Generate Victorian-styled PDF with formatting preserved
   - Create shareable PNG images with poem + decorative border
   - Download buttons on poem view page: "Download PDF" / "Save as Image"
   - Use libraries: jsPDF (PDF), html2canvas (images)
   - Include author credit, date, Victorian ornaments
   - **Why**: Offline preservation, social media sharing
   - **Complexity**: Medium (new dependencies, rendering logic)

3. **Comments on Public Poems**
   - New collection: `comments` with poemId, userId, text, timestamp
   - Comment section below poem content on view page
   - Reply threading (optional: flat or nested)
   - Edit/delete own comments
   - Comment count badge on poem cards
   - Moderation: author can delete comments on their poems
   - **Why**: Community engagement, feedback for authors
   - **Complexity**: Medium-High (new collection, real-time updates)

4. **Like/Appreciation System**
   - Simple like counter on public poems
   - Heart icon button (filled when liked by user)
   - New collection: `likes` with userId + poemId pairs
   - Display like count on poem cards and view page
   - Sort gallery by "Most Liked" option
   - **Why**: Social validation, discover popular content
   - **Complexity**: Medium (new collection, aggregation logic)

5. **User Collections/Folders**
   - Create custom folders: "Love Poems", "Dark Poetry", etc.
   - Organize own poems into folders
   - New collection: `folders` with userId, name, poemIds array
   - Drag-and-drop UI for organization (optional)
   - Filter My Poems by folder
   - **Why**: Organization for prolific users
   - **Complexity**: Medium-High (new collection, complex UI)

6. **Poem Analytics Dashboard**
   - Track views, shares, likes over time
   - Chart.js integration for visual stats
   - Show on My Poems page: "Top Performing Poem", "Total Reach"
   - Daily/weekly/monthly view breakdowns
   - **Why**: Author insights, motivation
   - **Complexity**: Medium (analytics logic, charting library)

### LOWER PRIORITY (High Complexity or Niche Value)

7. **Poem Versioning/History**
   - Save edit history with timestamps
   - New subcollection: `poems/{id}/versions`
   - "View History" page showing timeline
   - Restore previous version functionality
   - Diff view showing changes between versions
   - **Why**: Safety net for editing, track evolution
   - **Complexity**: High (complex data model, diff UI)

8. **Collaborative Poems**
    - Invite other users to co-author poems
    - Permissions: view/edit/admin
    - Real-time collaborative editing (optional: Firebase Realtime DB)
    - Track contributions by author
    - **Why**: Creative collaboration feature
    - **Complexity**: Very High (real-time sync, permissions)

9. **Poem Contests/Challenges**
    - Weekly/monthly themed challenges
    - New collection: `challenges` with theme, deadline, entries
    - Submit poems to challenges
    - Community voting system
    - Leaderboard page showing winners
    - **Why**: Gamification, community building
    - **Complexity**: High (voting system, moderation)

10. **Following System**
    - Follow favorite authors
    - New collection: `follows` with followerId + followingId
    - Feed page showing poems from followed authors
    - Notification system for new poems from followed users
    - Follower/following counts on profiles
    - **Why**: Social network features
    - **Complexity**: Medium-High (new relationships, feed logic)

11. **Poem Recommendations**
    - AI-powered recommendations based on reading history
    - "You might also like..." section
    - Content-based filtering using categories/sentiment
    - Collaborative filtering using similar user preferences
    - **Why**: Discovery, increased engagement
    - **Complexity**: High (recommendation algorithm)

12. **Mobile App (PWA)**
    - Convert to Progressive Web App
    - Add service worker for offline reading
    - Install prompt for home screen
    - Push notifications for new comments/likes
    - **Why**: Mobile-first experience
    - **Complexity**: Medium (PWA setup, service workers)

13. **Multi-language Support (i18n)**
    - Translate UI to multiple languages
    - Generate poems in different languages via Groq
    - Language selector in header
    - Store user language preference
    - **Why**: Global reach
    - **Complexity**: Medium-High (translation files, Groq multi-lang)

14. **Audio Recitation**
    - Text-to-speech for poems
    - Play button with audio controls
    - Voice selection (male/female, accents)
    - Download audio file option
    - Integration: Web Speech API or ElevenLabs
    - **Why**: Accessibility, different consumption method
    - **Complexity**: Medium (TTS API integration)

15. **Poem Printing Templates**
    - Print-optimized layouts
    - Victorian border designs
    - Greeting card templates
    - Booklet/chapbook formatter (for poem collections)
    - **Why**: Physical keepsakes
    - **Complexity**: Medium (print CSS, templates)

### QUALITY OF LIFE IMPROVEMENTS

16. **Dark Mode**
    - Toggle in header for dark/light theme
    - Victorian dark palette: charcoal, muted gold, dark parchment
    - Store preference in localStorage
    - **Why**: Eye comfort, modern UX expectation
    - **Complexity**: Low-Medium (CSS variables, theme switcher)

17. **Keyboard Shortcuts**
    - Ctrl+K: Focus search
    - Ctrl+N: New poem
    - Esc: Close modals
    - Arrow keys: Navigate poem grid
    - **Why**: Power user efficiency
    - **Complexity**: Low (event listeners)

18. **Advanced Search**
    - Search by date range
    - Filter by word count
    - Search within specific author's poems
    - Boolean operators (AND, OR, NOT)
    - Save search filters as presets
    - **Why**: Better discovery for large collections
    - **Complexity**: Medium (complex filter logic)

19. **Email Notifications**
    - Notify on new comments on user's poems
    - Weekly digest of new poems in followed categories
    - Firebase Functions + SendGrid/Mailgun integration
    - User preference toggles for each notification type
    - **Why**: Re-engagement, community awareness
    - **Complexity**: High (email service, Firebase Functions)

20. **RSS Feed**
    - Generate RSS feed for each user's public poems
    - Gallery-wide RSS feed
    - Category-specific feeds
    - **Why**: Content syndication, followers
    - **Complexity**: Low-Medium (XML generation endpoint)

21. **Poem Duplication/Templates**
    - "Duplicate" button on My Poems page
    - Create poem from existing as template
    - Save formatting presets
    - **Why**: Workflow efficiency, consistent styling
    - **Complexity**: Low (copy functionality)

22. **Bulk Actions**
    - Select multiple poems in My Poems
    - Bulk delete, bulk make public/private
    - Bulk move to folder
    - **Why**: Management efficiency
    - **Complexity**: Medium (selection state, batch operations)

23. **Poem Import/Export**
    - Import poems from .txt/.docx files
    - Export entire collection as ZIP
    - Backup/restore functionality
    - **Why**: Data portability, migration
    - **Complexity**: Medium (file parsing, ZIP generation)

INSTRUCTIONS FOR CONTINUING ON NEW LAPTOP
------------------------------------------
1. Clone the repo
2. Read this file (todo.txt)
3. Ask Claude Code: "Read todo.txt and help me continue this project"
4. Claude will have full context and can help with:
   - Setting up environment
   - Continuing feature development
   - Bug fixes
   - Code improvements

CRITICAL NOTES
--------------
❌ DO NOT use emojis - use Lucide icons
❌ DO NOT use alert() or confirm() - use Modal.svelte
❌ DO NOT use orderBy() with where() in Firestore - sort client-side
✅ ALWAYS use Lucide icons from lucide-svelte
✅ ALWAYS use Modal component for user feedback
✅ ALWAYS follow Victorian color scheme (gold, sepia, parchment)
✅ Stats section has NO "Statistics" title (just the 3 stat boxes)

END OF FILE
